# =============================================================================
# LeverEdge Agent Fleet - Docker Compose Orchestration
# =============================================================================
# This file orchestrates ALL 40+ agents in the LeverEdge fleet
#
# Usage:
#   docker-compose -f docker-compose.fleet.yml up -d
#   docker-compose -f docker-compose.fleet.yml --profile creative up -d
#   docker-compose -f docker-compose.fleet.yml --profile all up -d
#
# Profiles:
#   - core: Essential infrastructure (event-bus, chronos, hades, etc.)
#   - security: Security agents (cerberus, port-manager, aegis, sentinel)
#   - creative: Creative fleet (muse, calliope, thalia, erato, clio)
#   - personal: Personal assistants (gym-coach, nutritionist, meal-planner, etc.)
#   - business: Business agents (heracles, librarian, themis, plutus, etc.)
#   - all: Everything
#
# =============================================================================

# =============================================================================
# NETWORKS
# =============================================================================
networks:
  fleet-net:
    name: leveredge-fleet-net
    driver: bridge

  # External networks (connect to existing infrastructure)
  control-plane-net:
    external: true
    name: control-plane-net

  stack_net:
    external: true
    name: stack_net

# =============================================================================
# VOLUMES
# =============================================================================
volumes:
  # Shared volumes
  fleet-logs:
    name: fleet-logs
  fleet-data:
    name: fleet-data
  event-bus-data:
    name: event-bus-data
  shared-backups:
    name: shared-backups

# =============================================================================
# EXTENSION FIELDS (reusable configurations)
# =============================================================================
x-common-env: &common-env
  PYTHONUNBUFFERED: "1"
  TZ: ${TIMEZONE:-America/New_York}
  EVENT_BUS_URL: http://event-bus:8099
  LOG_LEVEL: ${LOG_LEVEL:-INFO}

x-common-labels: &common-labels
  com.leveredge.fleet: "true"
  com.leveredge.version: "1.0.0"

x-healthcheck-defaults: &healthcheck-defaults
  interval: 30s
  timeout: 10s
  retries: 3
  start_period: 10s

x-resource-limits-small: &resource-limits-small
  deploy:
    resources:
      limits:
        cpus: '0.5'
        memory: 256M
      reservations:
        cpus: '0.1'
        memory: 128M

x-resource-limits-medium: &resource-limits-medium
  deploy:
    resources:
      limits:
        cpus: '1.0'
        memory: 512M
      reservations:
        cpus: '0.25'
        memory: 256M

x-resource-limits-large: &resource-limits-large
  deploy:
    resources:
      limits:
        cpus: '2.0'
        memory: 1G
      reservations:
        cpus: '0.5'
        memory: 512M

x-restart-policy: &restart-policy
  restart: unless-stopped

# =============================================================================
# SERVICES
# =============================================================================
services:

  # ===========================================================================
  # CORE INFRASTRUCTURE (Priority 1 - Start First)
  # ===========================================================================

  # ---------------------------------------------------------------------------
  # Event Bus - Central Message Broker (Port 8099)
  # ---------------------------------------------------------------------------
  event-bus:
    build:
      context: ./control-plane/event-bus
      dockerfile: Dockerfile
    container_name: event-bus
    hostname: event-bus
    <<: [*restart-policy, *resource-limits-small]
    profiles: ["core", "all"]
    environment:
      <<: *common-env
      EVENT_BUS_DB_PATH: /data/events.db
    volumes:
      - event-bus-data:/data
      - ./control-plane/event-bus:/app:ro
      - fleet-logs:/logs
    ports:
      - "${EVENT_BUS_PORT:-8099}:8099"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8099/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "event-bus"
      com.leveredge.group: "core"
      com.leveredge.port: "8099"

  # ---------------------------------------------------------------------------
  # Chronos - Scheduler Agent (Port 8010)
  # ---------------------------------------------------------------------------
  chronos:
    build:
      context: ./control-plane/agents/chronos
      dockerfile: Dockerfile
    container_name: chronos
    hostname: chronos
    <<: [*restart-policy, *resource-limits-small]
    profiles: ["core", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      N8N_API_KEY: ${N8N_API_KEY}
      N8N_URL: ${N8N_URL:-http://control-n8n:5678}
    volumes:
      - ./control-plane/agents/chronos:/app:ro
      - shared-backups:/opt/leveredge/shared/backups
      - fleet-logs:/logs
    ports:
      - "${CHRONOS_PORT:-8010}:8010"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8010/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "chronos"
      com.leveredge.group: "core"
      com.leveredge.port: "8010"

  # ---------------------------------------------------------------------------
  # Hades - Backup & Recovery Agent (Port 8008)
  # ---------------------------------------------------------------------------
  hades:
    build:
      context: ./control-plane/agents/hades
      dockerfile: Dockerfile
    container_name: hades
    hostname: hades
    <<: [*restart-policy, *resource-limits-small]
    profiles: ["core", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
      chronos:
        condition: service_healthy
    environment:
      <<: *common-env
      N8N_API_KEY: ${N8N_API_KEY}
      N8N_URL: ${N8N_URL:-http://control-n8n:5678}
      CHRONOS_URL: http://chronos:8010
    volumes:
      - ./control-plane/agents/hades:/app:ro
      - shared-backups:/opt/leveredge/shared/backups
      - fleet-logs:/logs
    ports:
      - "${HADES_PORT:-8008}:8008"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8008/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "hades"
      com.leveredge.group: "core"
      com.leveredge.port: "8008"

  # ---------------------------------------------------------------------------
  # Hermes - Notification Agent (Port 8014)
  # ---------------------------------------------------------------------------
  hermes:
    build:
      context: ./control-plane/agents/hermes
      dockerfile: Dockerfile
    container_name: hermes
    hostname: hermes
    <<: [*restart-policy, *resource-limits-small]
    profiles: ["core", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      TELEGRAM_TOKEN: ${TELEGRAM_TOKEN:-}
      TELEGRAM_CHAT_ID: ${TELEGRAM_CHAT_ID:-}
      SLACK_WEBHOOK_URL: ${SLACK_WEBHOOK_URL:-}
      EMAIL_SMTP_HOST: ${EMAIL_SMTP_HOST:-}
      EMAIL_SMTP_PORT: ${EMAIL_SMTP_PORT:-587}
      EMAIL_USERNAME: ${EMAIL_USERNAME:-}
      EMAIL_PASSWORD: ${EMAIL_PASSWORD:-}
    volumes:
      - ./control-plane/agents/hermes:/app:ro
      - ./control-plane/agents/hermes/data:/app/data
      - fleet-logs:/logs
    ports:
      - "${HERMES_PORT:-8014}:8014"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8014/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "hermes"
      com.leveredge.group: "core"
      com.leveredge.port: "8014"

  # ---------------------------------------------------------------------------
  # Argus - Monitoring Agent (Port 8016)
  # ---------------------------------------------------------------------------
  argus:
    build:
      context: ./control-plane/agents/argus
      dockerfile: Dockerfile
    container_name: argus
    hostname: argus
    <<: [*restart-policy, *resource-limits-small]
    profiles: ["core", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
      hermes:
        condition: service_healthy
    environment:
      <<: *common-env
      PROMETHEUS_URL: ${PROMETHEUS_URL:-http://prometheus:9090}
      HERMES_URL: http://hermes:8014
    volumes:
      - ./control-plane/agents/argus:/app:ro
      - fleet-logs:/logs
    ports:
      - "${ARGUS_PORT:-8016}:8016"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8016/health"]
    networks:
      - fleet-net
      - control-plane-net
      - stack_net
    labels:
      <<: *common-labels
      com.leveredge.agent: "argus"
      com.leveredge.group: "core"
      com.leveredge.port: "8016"

  # ---------------------------------------------------------------------------
  # Aloy - AI Interface Agent (Port 8015)
  # ---------------------------------------------------------------------------
  aloy:
    build:
      context: ./control-plane/agents/aloy
      dockerfile: Dockerfile
    container_name: aloy
    hostname: aloy
    <<: [*restart-policy, *resource-limits-small]
    profiles: ["core", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
      hermes:
        condition: service_healthy
    environment:
      <<: *common-env
      HERMES_URL: http://hermes:8014
    volumes:
      - ./control-plane/agents/aloy:/app:ro
      - ./control-plane/agents/aloy/data:/app/data
      - fleet-logs:/logs
    ports:
      - "${ALOY_PORT:-8015}:8015"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8015/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "aloy"
      com.leveredge.group: "core"
      com.leveredge.port: "8015"

  # ---------------------------------------------------------------------------
  # Athena - Documentation Agent (Port 8013)
  # ---------------------------------------------------------------------------
  athena:
    build:
      context: ./control-plane/agents/athena
      dockerfile: Dockerfile
    container_name: athena
    hostname: athena
    <<: [*restart-policy, *resource-limits-small]
    profiles: ["core", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      DOCS_PATH: /opt/leveredge
    volumes:
      - ./control-plane/agents/athena:/app:ro
      - ./:/opt/leveredge:ro
      - fleet-logs:/logs
    ports:
      - "${ATHENA_PORT:-8013}:8013"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8013/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "athena"
      com.leveredge.group: "core"
      com.leveredge.port: "8013"

  # ---------------------------------------------------------------------------
  # Chiron - Medical Knowledge Agent (Port 8017)
  # ---------------------------------------------------------------------------
  chiron:
    build:
      context: ./control-plane/agents/chiron
      dockerfile: Dockerfile
    container_name: chiron
    hostname: chiron
    <<: [*restart-policy, *resource-limits-medium]
    profiles: ["core", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
    volumes:
      - ./control-plane/agents/chiron:/app:ro
      - ./control-plane/shared:/opt/leveredge/control-plane/shared:ro
      - fleet-logs:/logs
    ports:
      - "${CHIRON_PORT:-8017}:8017"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8017/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "chiron"
      com.leveredge.group: "core"
      com.leveredge.port: "8017"

  # ---------------------------------------------------------------------------
  # Scholar - Research Agent (Port 8018)
  # ---------------------------------------------------------------------------
  scholar:
    build:
      context: ./control-plane/agents/scholar
      dockerfile: Dockerfile
    container_name: scholar
    hostname: scholar
    <<: [*restart-policy, *resource-limits-medium]
    profiles: ["core", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
    volumes:
      - ./control-plane/agents/scholar:/app:ro
      - ./control-plane/shared:/opt/leveredge/control-plane/shared:ro
      - fleet-logs:/logs
    ports:
      - "${SCHOLAR_PORT:-8018}:8018"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8018/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "scholar"
      com.leveredge.group: "core"
      com.leveredge.port: "8018"

  # ---------------------------------------------------------------------------
  # Hephaestus MCP - MCP Server (Port 8011)
  # ---------------------------------------------------------------------------
  hephaestus-mcp:
    build:
      context: ./control-plane/agents/hephaestus
      dockerfile: Dockerfile.mcp
    container_name: hephaestus-mcp
    hostname: hephaestus-mcp
    <<: [*restart-policy, *resource-limits-medium]
    profiles: ["core", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      MCP_SERVER_NAME: hephaestus
    volumes:
      - ./control-plane/agents/hephaestus:/app:ro
      - fleet-logs:/logs
    ports:
      - "${HEPHAESTUS_MCP_PORT:-8011}:8011"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8011/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "hephaestus-mcp"
      com.leveredge.group: "core"
      com.leveredge.port: "8011"

  # ===========================================================================
  # SECURITY AGENTS
  # ===========================================================================

  # ---------------------------------------------------------------------------
  # Aegis - Security Agent (Port 8012)
  # ---------------------------------------------------------------------------
  aegis:
    build:
      context: ./control-plane/agents/aegis
      dockerfile: Dockerfile
    container_name: aegis
    hostname: aegis
    <<: [*restart-policy, *resource-limits-medium]
    profiles: ["security", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      HERMES_URL: http://hermes:8014
      POSTGRES_HOST: ${POSTGRES_HOST:-localhost}
      POSTGRES_PORT: ${POSTGRES_PORT:-5432}
      POSTGRES_DB: ${POSTGRES_DB:-leveredge}
      POSTGRES_USER: ${POSTGRES_USER:-leveredge}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
    volumes:
      - ./control-plane/agents/aegis:/app:ro
      - fleet-logs:/logs
    ports:
      - "${AEGIS_PORT:-8012}:8012"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8012/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "aegis"
      com.leveredge.group: "security"
      com.leveredge.port: "8012"

  # ---------------------------------------------------------------------------
  # Sentinel - Routing & Failover Agent (Port 8019)
  # ---------------------------------------------------------------------------
  sentinel:
    build:
      context: ./control-plane/agents/sentinel
      dockerfile: Dockerfile
    container_name: sentinel
    hostname: sentinel
    <<: [*restart-policy, *resource-limits-small]
    profiles: ["security", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
      hermes:
        condition: service_healthy
    environment:
      <<: *common-env
      REGISTRY_PATH: /opt/leveredge/config/agent-registry.yaml
      FASTAPI_ATLAS_URL: http://atlas:8208
      N8N_ATLAS_URL: ${N8N_URL:-http://control-n8n:5678}
      HERMES_URL: http://hermes:8014
    volumes:
      - ./control-plane/agents/sentinel:/app:ro
      - ./config:/opt/leveredge/config:ro
      - fleet-logs:/logs
    ports:
      - "${SENTINEL_PORT:-8019}:8019"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8019/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "sentinel"
      com.leveredge.group: "security"
      com.leveredge.port: "8019"

  # ---------------------------------------------------------------------------
  # Cerberus - API Gateway Agent (Port 8020)
  # ---------------------------------------------------------------------------
  cerberus:
    build:
      context: ./control-plane/agents/cerberus
      dockerfile: Dockerfile
    container_name: cerberus
    hostname: cerberus
    <<: [*restart-policy, *resource-limits-medium]
    profiles: ["security", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
      aegis:
        condition: service_healthy
    environment:
      <<: *common-env
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
      AEGIS_URL: http://aegis:8012
      HERMES_URL: http://hermes:8014
    volumes:
      - ./control-plane/agents/cerberus:/app:ro
      - ./control-plane/shared:/opt/leveredge/control-plane/shared:ro
      - fleet-logs:/logs
    ports:
      - "${CERBERUS_PORT:-8020}:8020"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8020/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "cerberus"
      com.leveredge.group: "security"
      com.leveredge.port: "8020"

  # ---------------------------------------------------------------------------
  # Port Manager - Port Allocation Agent (Port 8021)
  # ---------------------------------------------------------------------------
  port-manager:
    build:
      context: ./control-plane/agents/port-manager
      dockerfile: Dockerfile
    container_name: port-manager
    hostname: port-manager
    <<: [*restart-policy, *resource-limits-small]
    profiles: ["security", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
    volumes:
      - ./control-plane/agents/port-manager:/app:ro
      - fleet-logs:/logs
    ports:
      - "${PORT_MANAGER_PORT:-8021}:8021"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8021/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "port-manager"
      com.leveredge.group: "security"
      com.leveredge.port: "8021"

  # ---------------------------------------------------------------------------
  # Varys - Intelligence Agent (Port 8022)
  # ---------------------------------------------------------------------------
  varys:
    build:
      context: ./control-plane/agents/varys
      dockerfile: Dockerfile
    container_name: varys
    hostname: varys
    <<: [*restart-policy, *resource-limits-small]
    profiles: ["security", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
    volumes:
      - ./control-plane/agents/varys:/app:ro
      - fleet-logs:/logs
    ports:
      - "${VARYS_PORT:-8022}:8020"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8020/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "varys"
      com.leveredge.group: "security"
      com.leveredge.port: "8022"

  # ===========================================================================
  # CREATIVE FLEET (8030-8034)
  # ===========================================================================

  # ---------------------------------------------------------------------------
  # Muse - Creative Writing Agent (Port 8030)
  # ---------------------------------------------------------------------------
  muse:
    build:
      context: ./control-plane/agents/muse
      dockerfile: Dockerfile
    container_name: muse
    hostname: muse
    <<: [*restart-policy, *resource-limits-medium]
    profiles: ["creative", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
    volumes:
      - ./control-plane/agents/muse:/app:ro
      - fleet-logs:/logs
      - fleet-data:/data
    ports:
      - "${MUSE_PORT:-8030}:8030"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8030/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "muse"
      com.leveredge.group: "creative"
      com.leveredge.port: "8030"

  # ---------------------------------------------------------------------------
  # Calliope - Epic Writing Agent (Port 8031)
  # ---------------------------------------------------------------------------
  calliope:
    build:
      context: ./control-plane/agents/calliope
      dockerfile: Dockerfile
    container_name: calliope
    hostname: calliope
    <<: [*restart-policy, *resource-limits-medium]
    profiles: ["creative", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
    volumes:
      - ./control-plane/agents/calliope:/app:ro
      - fleet-logs:/logs
      - fleet-data:/data
    ports:
      - "${CALLIOPE_PORT:-8031}:8031"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8031/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "calliope"
      com.leveredge.group: "creative"
      com.leveredge.port: "8031"

  # ---------------------------------------------------------------------------
  # Thalia - Design Agent (Port 8032)
  # ---------------------------------------------------------------------------
  thalia:
    build:
      context: ./control-plane/agents/thalia
      dockerfile: Dockerfile
    container_name: thalia
    hostname: thalia
    <<: [*restart-policy, *resource-limits-medium]
    profiles: ["creative", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
    volumes:
      - ./control-plane/agents/thalia:/app:ro
      - fleet-logs:/logs
      - fleet-data:/data
    ports:
      - "${THALIA_PORT:-8032}:8032"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8032/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "thalia"
      com.leveredge.group: "creative"
      com.leveredge.port: "8032"

  # ---------------------------------------------------------------------------
  # Erato - Media Producer Agent (Port 8033)
  # ---------------------------------------------------------------------------
  erato:
    build:
      context: ./control-plane/agents/erato
      dockerfile: Dockerfile
    container_name: erato
    hostname: erato
    <<: [*restart-policy, *resource-limits-large]
    profiles: ["creative", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
      OPENAI_API_KEY: ${OPENAI_API_KEY}
    volumes:
      - ./control-plane/agents/erato:/app:ro
      - fleet-logs:/logs
      - fleet-data:/data
    ports:
      - "${ERATO_PORT:-8033}:8033"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8033/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "erato"
      com.leveredge.group: "creative"
      com.leveredge.port: "8033"

  # ---------------------------------------------------------------------------
  # Clio - History & Research Agent (Port 8034)
  # ---------------------------------------------------------------------------
  clio:
    build:
      context: ./control-plane/agents/clio
      dockerfile: Dockerfile
    container_name: clio
    hostname: clio
    <<: [*restart-policy, *resource-limits-medium]
    profiles: ["creative", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
    volumes:
      - ./control-plane/agents/clio:/app:ro
      - fleet-logs:/logs
      - fleet-data:/data
    ports:
      - "${CLIO_PORT:-8034}:8034"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8034/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "clio"
      com.leveredge.group: "creative"
      com.leveredge.port: "8034"

  # ===========================================================================
  # PERSONAL ASSISTANTS (8100-8110)
  # ===========================================================================

  # ---------------------------------------------------------------------------
  # Gym Coach - Fitness Agent (Port 8100)
  # ---------------------------------------------------------------------------
  gym-coach:
    build:
      context: ./control-plane/agents/gym-coach
      dockerfile: Dockerfile
    container_name: gym-coach
    hostname: gym-coach
    <<: [*restart-policy, *resource-limits-medium]
    profiles: ["personal", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
    volumes:
      - ./control-plane/agents/gym-coach:/app:ro
      - ./control-plane/shared:/opt/leveredge/control-plane/shared:ro
      - fleet-logs:/logs
      - fleet-data:/data
    ports:
      - "${GYM_COACH_PORT:-8100}:8100"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8100/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "gym-coach"
      com.leveredge.group: "personal"
      com.leveredge.port: "8100"

  # ---------------------------------------------------------------------------
  # Nutritionist - Nutrition Agent (Port 8101)
  # ---------------------------------------------------------------------------
  nutritionist:
    build:
      context: ./control-plane/agents/nutritionist
      dockerfile: Dockerfile
    container_name: nutritionist
    hostname: nutritionist
    <<: [*restart-policy, *resource-limits-medium]
    profiles: ["personal", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
    volumes:
      - ./control-plane/agents/nutritionist:/app:ro
      - ./control-plane/shared:/opt/leveredge/control-plane/shared:ro
      - fleet-logs:/logs
      - fleet-data:/data
    ports:
      - "${NUTRITIONIST_PORT:-8101}:8101"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8101/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "nutritionist"
      com.leveredge.group: "personal"
      com.leveredge.port: "8101"

  # ---------------------------------------------------------------------------
  # Meal Planner - Meal Planning Agent (Port 8102)
  # ---------------------------------------------------------------------------
  meal-planner:
    build:
      context: ./control-plane/agents/meal-planner
      dockerfile: Dockerfile
    container_name: meal-planner
    hostname: meal-planner
    <<: [*restart-policy, *resource-limits-medium]
    profiles: ["personal", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
    volumes:
      - ./control-plane/agents/meal-planner:/app:ro
      - ./control-plane/shared:/opt/leveredge/control-plane/shared:ro
      - fleet-logs:/logs
      - fleet-data:/data
    ports:
      - "${MEAL_PLANNER_PORT:-8102}:8102"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8102/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "meal-planner"
      com.leveredge.group: "personal"
      com.leveredge.port: "8102"

  # ---------------------------------------------------------------------------
  # Academic Guide - Education Agent (Port 8103)
  # ---------------------------------------------------------------------------
  academic-guide:
    build:
      context: ./control-plane/agents/academic-guide
      dockerfile: Dockerfile
    container_name: academic-guide
    hostname: academic-guide
    <<: [*restart-policy, *resource-limits-medium]
    profiles: ["personal", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
    volumes:
      - ./control-plane/agents/academic-guide:/app:ro
      - ./control-plane/shared:/opt/leveredge/control-plane/shared:ro
      - fleet-logs:/logs
      - fleet-data:/data
    ports:
      - "${ACADEMIC_GUIDE_PORT:-8103}:8103"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8103/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "academic-guide"
      com.leveredge.group: "personal"
      com.leveredge.port: "8103"

  # ---------------------------------------------------------------------------
  # Eros - Relationship Agent (Port 8104)
  # ---------------------------------------------------------------------------
  eros:
    build:
      context: ./control-plane/agents/eros
      dockerfile: Dockerfile
    container_name: eros
    hostname: eros
    <<: [*restart-policy, *resource-limits-medium]
    profiles: ["personal", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
    volumes:
      - ./control-plane/agents/eros:/app:ro
      - ./control-plane/shared:/opt/leveredge/control-plane/shared:ro
      - fleet-logs:/logs
      - fleet-data:/data
    ports:
      - "${EROS_PORT:-8104}:8104"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8104/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "eros"
      com.leveredge.group: "personal"
      com.leveredge.port: "8104"

  # ===========================================================================
  # BUSINESS AGENTS (8200-8209)
  # ===========================================================================

  # ---------------------------------------------------------------------------
  # Heracles - Task Management Agent (Port 8200)
  # ---------------------------------------------------------------------------
  heracles:
    build:
      context: ./control-plane/agents/heracles
      dockerfile: Dockerfile
    container_name: heracles
    hostname: heracles
    <<: [*restart-policy, *resource-limits-medium]
    profiles: ["business", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
    volumes:
      - ./control-plane/agents/heracles:/app:ro
      - ./control-plane/shared:/opt/leveredge/control-plane/shared:ro
      - fleet-logs:/logs
      - fleet-data:/data
    ports:
      - "${HERACLES_PORT:-8200}:8200"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8200/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "heracles"
      com.leveredge.group: "business"
      com.leveredge.port: "8200"

  # ---------------------------------------------------------------------------
  # REMOVED: Librarian (Port 8201) - Ghost entry, directory doesn't exist
  # LCIS-LIBRARIAN (Port 8050) is the canonical knowledge management agent
  # ---------------------------------------------------------------------------

  # ---------------------------------------------------------------------------
  # Workflow Builder - Automation Agent (Port 8202)
  # ---------------------------------------------------------------------------
  workflow-builder:
    build:
      context: ./control-plane/agents/workflow-builder
      dockerfile: Dockerfile
    container_name: workflow-builder
    hostname: workflow-builder
    <<: [*restart-policy, *resource-limits-medium]
    profiles: ["business", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
      N8N_API_KEY: ${N8N_API_KEY}
      N8N_URL: ${N8N_URL:-http://control-n8n:5678}
    volumes:
      - ./control-plane/agents/workflow-builder:/app:ro
      - ./control-plane/shared:/opt/leveredge/control-plane/shared:ro
      - fleet-logs:/logs
      - fleet-data:/data
    ports:
      - "${WORKFLOW_BUILDER_PORT:-8202}:8202"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8202/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "workflow-builder"
      com.leveredge.group: "business"
      com.leveredge.port: "8202"

  # ---------------------------------------------------------------------------
  # Themis - Legal/Compliance Agent (Port 8203)
  # ---------------------------------------------------------------------------
  themis:
    build:
      context: ./control-plane/agents/themis
      dockerfile: Dockerfile
    container_name: themis
    hostname: themis
    <<: [*restart-policy, *resource-limits-medium]
    profiles: ["business", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
    volumes:
      - ./control-plane/agents/themis:/app:ro
      - ./control-plane/shared:/opt/leveredge/control-plane/shared:ro
      - fleet-logs:/logs
      - fleet-data:/data
    ports:
      - "${THEMIS_PORT:-8203}:8203"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8203/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "themis"
      com.leveredge.group: "business"
      com.leveredge.port: "8203"

  # ---------------------------------------------------------------------------
  # Mentor - Coaching Agent (Port 8204)
  # ---------------------------------------------------------------------------
  mentor:
    build:
      context: ./control-plane/agents/mentor
      dockerfile: Dockerfile
    container_name: mentor
    hostname: mentor
    <<: [*restart-policy, *resource-limits-medium]
    profiles: ["business", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
    volumes:
      - ./control-plane/agents/mentor:/app:ro
      - ./control-plane/shared:/opt/leveredge/control-plane/shared:ro
      - fleet-logs:/logs
      - fleet-data:/data
    ports:
      - "${MENTOR_PORT:-8204}:8204"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8204/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "mentor"
      com.leveredge.group: "business"
      com.leveredge.port: "8204"

  # ---------------------------------------------------------------------------
  # Plutus - Finance Agent (Port 8205)
  # ---------------------------------------------------------------------------
  plutus:
    build:
      context: ./control-plane/agents/plutus
      dockerfile: Dockerfile
    container_name: plutus
    hostname: plutus
    <<: [*restart-policy, *resource-limits-medium]
    profiles: ["business", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
    volumes:
      - ./control-plane/agents/plutus:/app:ro
      - ./control-plane/shared:/opt/leveredge/control-plane/shared:ro
      - fleet-logs:/logs
      - fleet-data:/data
    ports:
      - "${PLUTUS_PORT:-8205}:8205"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8205/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "plutus"
      com.leveredge.group: "business"
      com.leveredge.port: "8205"

  # ---------------------------------------------------------------------------
  # Procurement - Purchasing Agent (Port 8206)
  # ---------------------------------------------------------------------------
  procurement:
    build:
      context: ./control-plane/agents/procurement
      dockerfile: Dockerfile
    container_name: procurement
    hostname: procurement
    <<: [*restart-policy, *resource-limits-medium]
    profiles: ["business", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
    volumes:
      - ./control-plane/agents/procurement:/app:ro
      - ./control-plane/shared:/opt/leveredge/control-plane/shared:ro
      - fleet-logs:/logs
      - fleet-data:/data
    ports:
      - "${PROCUREMENT_PORT:-8206}:8206"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8206/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "procurement"
      com.leveredge.group: "business"
      com.leveredge.port: "8206"

  # ---------------------------------------------------------------------------
  # Hephaestus Server - Infrastructure Admin Agent (Port 8207)
  # ---------------------------------------------------------------------------
  hephaestus-server:
    build:
      context: ./control-plane/agents/hephaestus
      dockerfile: Dockerfile.server-admin
    container_name: hephaestus-server
    hostname: hephaestus-server
    <<: [*restart-policy, *resource-limits-medium]
    profiles: ["business", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
    volumes:
      - ./control-plane/agents/hephaestus:/app:ro
      - ./control-plane/shared:/opt/leveredge/control-plane/shared:ro
      - fleet-logs:/logs
      - fleet-data:/data
    ports:
      - "${HEPHAESTUS_SERVER_PORT:-8207}:8207"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8207/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "hephaestus-server"
      com.leveredge.group: "business"
      com.leveredge.port: "8207"

  # ---------------------------------------------------------------------------
  # Atlas - Orchestration Agent (Port 8208)
  # ---------------------------------------------------------------------------
  atlas:
    build:
      context: ./control-plane/agents/atlas
      dockerfile: Dockerfile
    container_name: atlas
    hostname: atlas
    <<: [*restart-policy, *resource-limits-large]
    profiles: ["business", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
      HERMES_URL: http://hermes:8014
    volumes:
      - ./control-plane/agents/atlas:/app:ro
      - ./control-plane/shared:/opt/leveredge/control-plane/shared:ro
      - fleet-logs:/logs
      - fleet-data:/data
    ports:
      - "${ATLAS_PORT:-8208}:8208"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8208/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "atlas"
      com.leveredge.group: "business"
      com.leveredge.port: "8208"

  # ---------------------------------------------------------------------------
  # Iris - Communication Agent (Port 8209)
  # ---------------------------------------------------------------------------
  iris:
    build:
      context: ./control-plane/agents/iris
      dockerfile: Dockerfile
    container_name: iris
    hostname: iris
    <<: [*restart-policy, *resource-limits-medium]
    profiles: ["business", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
    volumes:
      - ./control-plane/agents/iris:/app:ro
      - ./control-plane/shared:/opt/leveredge/control-plane/shared:ro
      - fleet-logs:/logs
      - fleet-data:/data
    ports:
      - "${IRIS_PORT:-8209}:8209"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8209/health"]
    networks:
      - fleet-net
      - control-plane-net
    labels:
      <<: *common-labels
      com.leveredge.agent: "iris"
      com.leveredge.group: "business"
      com.leveredge.port: "8209"

  # ---------------------------------------------------------------------------
  # Solon - Legal Advisor Agent (Port 8210)
  # ---------------------------------------------------------------------------
  solon:
    build:
      context: ./control-plane/agents/solon
      dockerfile: Dockerfile
    container_name: solon
    hostname: solon
    <<: [*restart-policy, *resource-limits-medium]
    profiles: ["business", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
      SUPABASE_URL: ${SUPABASE_URL:-http://supabase-kong:8000}
      SUPABASE_SERVICE_KEY: ${SUPABASE_SERVICE_KEY:-}
    volumes:
      - ./control-plane/agents/solon:/app:ro
      - ./shared:/opt/leveredge/shared:ro
      - fleet-logs:/logs
      - fleet-data:/data
    ports:
      - "${SOLON_PORT:-8210}:8210"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8210/health"]
    networks:
      - fleet-net
      - control-plane-net
      - stack_net
    labels:
      <<: *common-labels
      com.leveredge.agent: "solon"
      com.leveredge.group: "business"
      com.leveredge.port: "8210"

  # ---------------------------------------------------------------------------
  # Croesus - Tax & Wealth Advisor Agent (Port 8211)
  # ---------------------------------------------------------------------------
  croesus:
    build:
      context: ./control-plane/agents/croesus
      dockerfile: Dockerfile
    container_name: croesus
    hostname: croesus
    <<: [*restart-policy, *resource-limits-medium]
    profiles: ["business", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
      SUPABASE_URL: ${SUPABASE_URL:-http://supabase-kong:8000}
      SUPABASE_SERVICE_KEY: ${SUPABASE_SERVICE_KEY:-}
    volumes:
      - ./control-plane/agents/croesus:/app:ro
      - ./shared:/opt/leveredge/shared:ro
      - fleet-logs:/logs
      - fleet-data:/data
    ports:
      - "${CROESUS_PORT:-8211}:8211"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8211/health"]
    networks:
      - fleet-net
      - control-plane-net
      - stack_net
    labels:
      <<: *common-labels
      com.leveredge.agent: "quaestor"
      com.leveredge.group: "business"
      com.leveredge.port: "8211"

  # ---------------------------------------------------------------------------
  # STEWARD - Professional Coordination & Meeting Prep (Port 8220)
  # ---------------------------------------------------------------------------
  steward:
    build:
      context: ./control-plane/agents/steward
      dockerfile: Dockerfile
    container_name: steward
    hostname: steward
    <<: [*restart-policy, *resource-limits-medium]
    profiles: ["business", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      DATABASE_URL: postgresql://postgres:${DEV_POSTGRES_PASSWORD}@supabase-db-dev:5432/postgres
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
    volumes:
      - ./control-plane/agents/steward:/app:ro
      - fleet-logs:/logs
    ports:
      - "${STEWARD_PORT:-8220}:8220"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8220/health"]
    networks:
      - fleet-net
      - control-plane-net
      - stack_net
    labels:
      <<: *common-labels
      com.leveredge.agent: "steward"
      com.leveredge.group: "business"
      com.leveredge.port: "8220"

  # ---------------------------------------------------------------------------
  # ARIA Omniscience - Knowledge Ingest Service (Port 8112)
  # ---------------------------------------------------------------------------
  aria-omniscience:
    build:
      context: ./control-plane/agents/aria-omniscience
      dockerfile: Dockerfile
    container_name: aria-omniscience
    hostname: aria-omniscience
    <<: [*restart-policy, *resource-limits-small]
    profiles: ["core", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      SUPABASE_URL: ${SUPABASE_URL:-http://supabase-kong:8000}
      SUPABASE_SERVICE_KEY: ${SUPABASE_SERVICE_KEY:-}
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
    volumes:
      - ./control-plane/agents/aria-omniscience:/app:ro
      - fleet-logs:/logs
    ports:
      - "${ARIA_OMNISCIENCE_PORT:-8112}:8112"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8112/health"]
    networks:
      - fleet-net
      - control-plane-net
      - stack_net
    labels:
      <<: *common-labels
      com.leveredge.agent: "aria-omniscience"
      com.leveredge.group: "core"
      com.leveredge.port: "8112"

  # ---------------------------------------------------------------------------
  # THE CONCLAVE - Council Meeting System
  # ---------------------------------------------------------------------------

  # ---------------------------------------------------------------------------
  # Convener - Council Meeting Facilitator (Port 8300)
  # ---------------------------------------------------------------------------
  convener:
    build:
      context: ./control-plane/agents/convener
      dockerfile: Dockerfile
    container_name: convener
    hostname: convener
    <<: [*restart-policy, *resource-limits-medium]
    profiles: ["core", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY:-}
      SUPABASE_URL: ${SUPABASE_URL:-http://supabase-kong:8000}
      SUPABASE_SERVICE_KEY: ${SUPABASE_SERVICE_KEY:-}
      SCRIBE_URL: http://scribe:8301
    volumes:
      - ./control-plane/agents/convener:/app:ro
      - ./control-plane/shared:/opt/leveredge/control-plane/shared:ro
      - fleet-logs:/logs
    ports:
      - "${CONVENER_PORT:-8300}:8300"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8300/health"]
    networks:
      - fleet-net
      - control-plane-net
      - stack_net
    labels:
      <<: *common-labels
      com.leveredge.agent: "convener"
      com.leveredge.group: "council"
      com.leveredge.port: "8300"

  # ---------------------------------------------------------------------------
  # Scribe - Council Meeting Secretary (Port 8301)
  # ---------------------------------------------------------------------------
  scribe:
    build:
      context: ./control-plane/agents/scribe
      dockerfile: Dockerfile
    container_name: scribe
    hostname: scribe
    <<: [*restart-policy, *resource-limits-small]
    profiles: ["core", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY:-}
      SUPABASE_URL: ${SUPABASE_URL:-http://supabase-kong:8000}
      SUPABASE_SERVICE_KEY: ${SUPABASE_SERVICE_KEY:-}
      ARIA_OMNISCIENCE_URL: http://aria-omniscience:8112
    volumes:
      - ./control-plane/agents/scribe:/app:ro
      - ./control-plane/shared:/opt/leveredge/control-plane/shared:ro
      - fleet-logs:/logs
    ports:
      - "${SCRIBE_PORT:-8301}:8301"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8301/health"]
    networks:
      - fleet-net
      - control-plane-net
      - stack_net
    labels:
      <<: *common-labels
      com.leveredge.agent: "scribe"
      com.leveredge.group: "council"
      com.leveredge.port: "8301"

  # ===========================================================================
  # LCIS - LEVEREDGE COLLECTIVE INTELLIGENCE SYSTEM (8050-8059)
  # ===========================================================================

  # ---------------------------------------------------------------------------
  # LCIS Librarian - Knowledge Ingestion Service (Port 8050)
  # ---------------------------------------------------------------------------
  lcis-librarian:
    build:
      context: ./control-plane/agents/lcis-librarian
      dockerfile: Dockerfile
    container_name: lcis-librarian
    hostname: lcis-librarian
    <<: [*restart-policy, *resource-limits-small]
    profiles: ["core", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
    environment:
      <<: *common-env
      DATABASE_URL: postgresql://postgres:${DEV_POSTGRES_PASSWORD}@supabase-db-dev:5432/postgres
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
    volumes:
      - ./control-plane/agents/lcis-librarian:/app:ro
      - fleet-logs:/logs
    ports:
      - "${LCIS_LIBRARIAN_PORT:-8050}:8050"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8050/health"]
    networks:
      - fleet-net
      - control-plane-net
      - stack_net
    labels:
      <<: *common-labels
      com.leveredge.agent: "lcis-librarian"
      com.leveredge.group: "lcis"
      com.leveredge.port: "8050"

  # ---------------------------------------------------------------------------
  # LCIS Oracle - Pre-Action Consultation Service (Port 8052)
  # ---------------------------------------------------------------------------
  lcis-oracle:
    build:
      context: ./control-plane/agents/lcis-oracle
      dockerfile: Dockerfile
    container_name: lcis-oracle
    hostname: lcis-oracle
    <<: [*restart-policy, *resource-limits-small]
    profiles: ["core", "all"]
    depends_on:
      event-bus:
        condition: service_healthy
      lcis-librarian:
        condition: service_healthy
    environment:
      <<: *common-env
      DATABASE_URL: postgresql://postgres:${DEV_POSTGRES_PASSWORD}@supabase-db-dev:5432/postgres
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
    volumes:
      - ./control-plane/agents/lcis-oracle:/app:ro
      - fleet-logs:/logs
    ports:
      - "${LCIS_ORACLE_PORT:-8052}:8052"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8052/health"]
    networks:
      - fleet-net
      - control-plane-net
      - stack_net
    labels:
      <<: *common-labels
      com.leveredge.agent: "lcis-oracle"
      com.leveredge.group: "lcis"
      com.leveredge.port: "8052"
